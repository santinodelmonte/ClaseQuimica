<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<title>Escape Room Qu√≠mico - Sala 4 (Diagramas de Lewis)</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
  :root {
    --primary: #3a7ebf;
    --accent: #3abf7e;
    --dark: #1a2b3c;
    --light: #f0f8ff;
    --correct: #4caf50;
    --incorrect: #f44336;
  }
  body {
    background: linear-gradient(135deg, #1a2b3c 0%, #2c3e50 100%);
    color: var(--light);
    min-height: 100vh;
    padding: 20px 10px;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  .container-custom {
    background-color: rgba(255,255,255,0.08);
    backdrop-filter: blur(8px);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 8px 18px rgba(0,0,0,0.35);
    margin-bottom: 40px;
  }
  .diagram-container {
    position: relative;
    width: 220px;
    height: 220px;
    margin: 0 auto;
  }
  .element-center {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2;
  }
  .element-symbol-large {
    font-size: 3rem;
    font-weight: bold;
    background: var(--dark);
    width: 80px; height: 80px;
    border-radius: 50%;
    border: 3px solid var(--primary);
    display: flex; align-items: center; justify-content: center;
  }
  .electron-slot {
    width: 36px; height: 36px;
    border: 2px dashed var(--accent);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin: 5px;
  }
  .electron {
    width: 20px; height: 20px;
    background-color: var(--accent);
    border-radius: 50%;
    cursor: grab;
  }
  .electron:active { cursor: grabbing; }
  /* Distribuci√≥n con 5 divs */
  .slot-row { display: flex; justify-content: center; }
  .slot-col { display: flex; flex-direction: column; justify-content: center; }
  .slot-top { position: absolute; top: 0; left: 50%; transform: translateX(-50%); }
  .slot-bottom { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); }
  .slot-left { position: absolute; top: 50%; left: 0; transform: translateY(-50%); }
  .slot-right { position: absolute; top: 50%; right: 0; transform: translateY(-50%); }
  .electron-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 20px; }
  .feedback { margin-top: 20px; padding: 12px; border-radius: 8px; display: none; text-align: center; }
  .correct { background: rgba(76,175,80,0.15); border: 2px solid var(--correct); color: #c8e6c9; }
  .incorrect { background: rgba(244,67,54,0.15); border: 2px solid var(--incorrect); color: #ffcdd2; }
</style>
</head>
<body>
<header class="text-center mb-4">
  <h1>Escape Room Qu√≠mico</h1>
  <h2>Sala 4: Clave de los Electrones de Valencia</h2>
  
  <strong>Consigna:</strong> "Los siguientes elementos bloquean la puerta final. Arrastr√° los electrones desde abajo a su posici√≥n correcta."</p>
   <strong>üí° Recordatorio:</strong> Los diagramas de Lewis representan los electrones de valencia como puntos alrededor del s√≠mbolo del elemento.<br>
      Se colocan primero individualmente en los cuatro lados (arriba, derecha, abajo, izquierda) y luego se van apareando.
      <br>Arrastr√° los electrones desde abajo hacia las posiciones correctas.
</header>

<div id="elements-container"></div>

<div class="text-center">
  <button id="verify-all" class="btn btn-warning btn-lg mt-3">Verificar todos</button>
  <div id="global-feedback" class="feedback"></div>
</div>

<script>
const elements = [
  { symbol: "O", valence: 6, name: "Ox√≠geno" },
  { symbol: "C", valence: 4, name: "Carbono" },
  { symbol: "F", valence: 7, name: "Fl√∫or" },
  { symbol: "Al", valence: 3, name: "Aluminio" },
  { symbol: "N", valence: 5, name: "Nitr√≥geno" }
];

function createDiagram(el) {
  const container = document.createElement("div");
  container.className = "container container-custom";

  container.innerHTML = `
    <section>
      <h3 class="text-center mb-3">${el.name} (${el.symbol})</h3>
      <div class="diagram-container" data-element="${el.symbol}" data-valence="${el.valence}">
        <div class="element-center"><div class="element-symbol-large">${el.symbol}</div></div>
        <div class="slot-top slot-row">
          <div class="electron-slot" data-side="top"></div>
          <div class="electron-slot" data-side="top"></div>
        </div>
        <div class="slot-bottom slot-row">
          <div class="electron-slot" data-side="bottom"></div>
          <div class="electron-slot" data-side="bottom"></div>
        </div>
        <div class="slot-left slot-col">
          <div class="electron-slot" data-side="left"></div>
          <div class="electron-slot" data-side="left"></div>
        </div>
        <div class="slot-right slot-col">
          <div class="electron-slot" data-side="right"></div>
          <div class="electron-slot" data-side="right"></div>
        </div>
      </div>

      <div class="electron-container">
        <div class="electron" draggable="true"></div>
        <div class="electron" draggable="true"></div>
        <div class="electron" draggable="true"></div>
        <div class="electron" draggable="true"></div>
        <div class="electron" draggable="true"></div>
        <div class="electron" draggable="true"></div>
        <div class="electron" draggable="true"></div>
        <div class="electron" draggable="true"></div>
      </div>
    </section>
  `;

  return container;
}

document.addEventListener("DOMContentLoaded", () => {
  const container = document.getElementById("elements-container");
  elements.forEach(el => {
    container.appendChild(createDiagram(el));
  });

  let dragged = null;

  // Drag & drop electrones
  document.querySelectorAll(".electron").forEach(electron => {
    electron.addEventListener("dragstart", e => {
      dragged = electron;
      setTimeout(() => electron.style.visibility = "hidden", 0);
    });
    electron.addEventListener("dragend", e => {
      dragged.style.visibility = "visible";
      dragged = null;
    });
  });

  document.querySelectorAll(".electron-slot").forEach(slot => {
    slot.addEventListener("dragover", e => e.preventDefault());
    slot.addEventListener("drop", e => {
      e.preventDefault();
      if (!dragged) return;
      const side = slot.dataset.side;
      const slotsOnSide = Array.from(slot.parentNode.querySelectorAll(`[data-side='${side}']`));
      const filled = slotsOnSide.filter(s => s.children.length > 0).length;

      // Regla de Lewis: no poner par en un lado si otro est√° vac√≠o
      if (filled === 1) {
        const diagram = slot.closest(".diagram-container");
        const sides = ["top","bottom","left","right"];
        for (let s of sides) {
          const otherSlots = Array.from(diagram.querySelectorAll(`.electron-slot[data-side='${s}']`));
          if (otherSlots.every(os => os.children.length === 0) && s !== side) {
            alert("Primero coloca al menos un electr√≥n en cada lado antes de formar pares.");
            return;
          }
        }
      }

      if (slot.children.length === 0) slot.appendChild(dragged);
    });
  });

  document.querySelectorAll(".electron-container").forEach(ec => {
    ec.addEventListener("dragover", e => e.preventDefault());
    ec.addEventListener("drop", e => {
      e.preventDefault();
      if (dragged) ec.appendChild(dragged);
    });
  });

  // Verificaci√≥n global
  document.getElementById("verify-all").addEventListener("click", () => {
    const diagrams = document.querySelectorAll(".diagram-container");
    let results = [];
    let allCorrect = true;

    diagrams.forEach(diagram => {
      const valence = parseInt(diagram.dataset.valence);
      const placed = diagram.querySelectorAll(".electron-slot .electron").length;
      const symbol = diagram.dataset.element;

      if (placed === valence) {
        results.push(`‚úÖ ${symbol}: correcto (${valence} electrones de valencia).`);
      } else {
        results.push(`‚ùå ${symbol}: incorrecto. Revisa por favor`);
        allCorrect = false;
      }
    });

    const feedback = document.getElementById("global-feedback");
    feedback.style.display = "block";
    feedback.innerHTML = results.join("<br>");
    feedback.className = "feedback " + (allCorrect ? "correct" : "incorrect");
  });
});
</script>
</body>
</html>
